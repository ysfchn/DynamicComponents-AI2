name: "Build Extension"
on: [push, pull_request]
jobs:
    build:
        name: "Build"
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - name: "Update submodules"
              run: |
                  COMMIT=${1:-origin/master}
                  if [ ! -d "lib/appinventor" ]; then
                      git submodule add https://github.com/mit-cml/extension-deps.git lib/appinventor/
                      git submodule update --init lib/appinventor/
                  fi

                  cd lib/appinventor
                  git fetch origin
                  git checkout $COMMIT
                  cd ../..
            - name: "Set up JDK 1.8"
              uses: actions/setup-java@v1
              with:
                  java-version: 8
            - name: "Build Extension"
              run: ant extensions
            - name: "Upload the Extension as Artifact"
              uses: actions/upload-artifact@v2
              with:
                  name: Extension
                  path: out/*.aix
